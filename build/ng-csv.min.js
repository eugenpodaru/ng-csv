/*! ng-csv 21-10-2015 */
!function(a,b){angular.module("ngCsv.config",[]).value("ngCsv.config",{debug:!0}).config(["$compileProvider",function(a){angular.isDefined(a.urlSanitizationWhitelist)?a.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/):a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]),angular.module("ngCsv.directives",["ngCsv.services"]),angular.module("ngCsv.services",[]),angular.module("ngCsv",["ngCsv.config","ngCsv.services","ngCsv.directives","ngSanitize"]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ngCsv"),angular.module("ngCsv.services").service("CSV",["$q",function(a){var b="\r\n",c={"\\t":"	","\\b":"\b","\\v":"","\\f":"\f","\\r":"\r"};this.stringifyField=function(a,b){return"locale"===b.decimalSep&&this.isFloat(a)?a.toLocaleString():"."!==b.decimalSep&&this.isFloat(a)?a.toString().replace(".",b.decimalSep):"string"==typeof a?(a=a.replace(/"/g,'""'),(b.quoteStrings||a.indexOf(",")>-1||a.indexOf("\n")>-1||a.indexOf("\r")>-1)&&(a=b.txtDelim+a+b.txtDelim),a):"boolean"==typeof a?a?"TRUE":"FALSE":a},this.isFloat=function(a){return+a===a&&(!isFinite(a)||Boolean(a%1))},this.stringify=function(c,d){var e=a.defer(),f=this,g="",h="",i=a.when(c).then(function(a){if(angular.isDefined(d.header)&&d.header){var c,i;c=[],angular.forEach(d.header,function(a,b){this.push(f.stringifyField(a,d))},c),i=c.join(d.fieldSep?d.fieldSep:","),h+=i+b}var j=[];if(angular.isArray(a)?j=a:angular.isFunction(a)&&(j=a()),angular.isDefined(d.label)&&d.label&&"boolean"==typeof d.label){var k,l;k=[],angular.forEach(j[0],function(a,b){this.push(f.stringifyField(b,d))},k),l=k.join(d.fieldSep?d.fieldSep:","),h+=l+b}angular.forEach(j,function(a,c){var e,g,i=angular.copy(j[c]);g=[];var k=d.columnOrder?d.columnOrder:i;angular.forEach(k,function(a,b){var c=d.columnOrder?i[a]:a;this.push(f.stringifyField(c,d))},g),e=g.join(d.fieldSep?d.fieldSep:","),h+=c<j.length?e+b:e}),d.charset=d.charset||"utf-8",d.charset=d.charset.toLowerCase(),g="utf-16"===d.charset?f.utf16Encode(h,d.addByteOrderMarker):"utf-16le"===d.charset?f.utf16leEncode(h,d.addByteOrderMarker):"utf-16be"===d.charset?f.utf16beEncode(h,d.addByteOrderMarker):f.utf8Encode(h,d.addByteOrderMarker),e.resolve(g)});return"function"==typeof i["catch"]&&i["catch"](function(a){e.reject(a)}),e.promise},this.isSpecialChar=function(a){return void 0!==c[a]},this.getSpecialChar=function(a){return c[a]},this.utf16Encode=function(a,b){var c=[];b&&c.push(254,255);for(var d=0;d<a.length;d++){var e=a.charCodeAt(d);c.push((65280&e)>>>8),c.push(255&e)}return new Uint8Array(c)},this.utf16beEncode=function(a,b){return this.utf16Encode(a,b)},this.utf16leEncode=function(a,b){var c=[];b&&c.push(255,254);for(var d=0;d<a.length;d++){var e=a.charCodeAt(d);c.push(255&e),c.push((65280&e)>>>8)}return new Uint8Array(c)},this.utf8Encode=function(a,b){var c=[];b&&c.push(239,187,191);for(var d=0;d<a.length;d++){var e=a.charCodeAt(d);128>e?c.push(e):e>127&&2048>e?(c.push(e>>6|192),c.push(63&e|128)):(c.push(e>>12|224),c.push(e>>6&63|128),c.push(63&e|128))}return new Uint8Array(c)}}]),angular.module("ngCsv.directives").directive("ngCsv",["$parse","$q","CSV","$document","$timeout",function(b,c,d,e,f){return{restrict:"AC",scope:{data:"&ngCsv",filename:"@filename",header:"&csvHeader",columnOrder:"&csvColumnOrder",txtDelim:"@textDelimiter",decimalSep:"@decimalSeparator",quoteStrings:"@quoteStrings",fieldSep:"@fieldSeparator",lazyLoad:"@lazyLoad",addByteOrderMarker:"@addBom",ngClick:"&",charset:"@charset",label:"&csvLabel"},controller:["$scope","$element","$attrs","$transclude",function(a,b,e,f){function g(){var b={txtDelim:a.txtDelim?a.txtDelim:'"',decimalSep:a.decimalSep?a.decimalSep:".",quoteStrings:a.quoteStrings,addByteOrderMarker:a.addByteOrderMarker,charset:a.charset};return angular.isDefined(e.csvHeader)&&(b.header=a.$eval(a.header)),angular.isDefined(e.csvColumnOrder)&&(b.columnOrder=a.$eval(a.columnOrder)),angular.isDefined(e.csvLabel)&&(b.label=a.$eval(a.label)),b.fieldSep=a.fieldSep?a.fieldSep:",",b.fieldSep=d.isSpecialChar(b.fieldSep)?d.getSpecialChar(b.fieldSep):b.fieldSep,b}a.csv="",angular.isDefined(a.lazyLoad)&&"true"==a.lazyLoad||angular.isArray(a.data)&&a.$watch("data",function(b){a.buildCSV()},!0),a.getFilename=function(){return a.filename||"download.csv"},a.buildCSV=function(){var f=c.defer();return b.addClass(e.ngCsvLoadingClass||"ng-csv-loading"),d.stringify(a.data(),g()).then(function(c){a.csv=c,b.removeClass(e.ngCsvLoadingClass||"ng-csv-loading"),f.resolve(c)}),a.$apply(),f.promise}}],link:function(b,c,d){function g(){var c=b.charset||"utf-8",d=new Blob([b.csv],{type:"text/csv;charset="+c+";"});if(a.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(d,b.getFilename());else{var g=angular.element('<div data-tap-disabled="true"><a></a></div>'),h=angular.element(g.children()[0]);h.attr("href",a.URL.createObjectURL(d)),h.attr("download",b.getFilename()),h.attr("target","_blank"),e.find("body").append(g),f(function(){h[0].click(),h.remove()},null)}}c.bind("click",function(a){b.buildCSV().then(function(a){g()}),b.$apply()})}}}])}(window,document);